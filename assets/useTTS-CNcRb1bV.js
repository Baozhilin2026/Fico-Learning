var V=Object.defineProperty;var B=(a,t,e)=>t in a?V(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var v=(a,t,e)=>B(a,typeof t!="symbol"?t+"":t,e);import{_ as M}from"./logo-gN9joe7j.js";import{d as x,a7 as O,h as W,u as z,r as b,g as _,c as P,a as S,F as D,C as F,j as U,w as C,H as j,k as q,t as E,S as K,e as J,b as N,a8 as H,m as $,K as m,Z as Q,a9 as Y,q as Z,s as X,v as ee,x as te,y as ne,J as ae,n as A,aa as se,P as oe}from"./index-BBjULrD7.js";import{u as re,_ as ie}from"./_plugin-vue_export-helper-DOvgmkbR.js";const ce={class:"top-navbar"},le={class:"navbar-container"},ue={class:"navbar-menu"},de={class:"navbar-actions"},ge=x({__name:"TopNavbar",setup(a){const t=O(),e=W(),r=z(),{t:s}=re(),o=m(()=>[{name:"Home",path:"/home",label:s("nav.home"),icon:Y},{name:"Vocabulary",path:"/vocabulary",label:s("nav.vocabulary"),icon:Z},{name:"Communication",path:"/communication",label:s("nav.communication"),icon:X},{name:"Interview",path:"/interview",label:s("nav.interview"),icon:ee},{name:"MockInterview",path:"/mock-interview",label:s("nav.mockInterview"),icon:te},{name:"Bookmarks",path:"/bookmarks",label:s("nav.bookmarks"),icon:ne}]);function c(i){return t.path===i||t.path.startsWith(i+"/")}async function l(){try{await Q.confirm(s("auth.logoutConfirm"),s("auth.logoutTitle"),{confirmButtonText:s("common.confirm"),cancelButtonText:s("common.cancel"),type:"warning"}),r.logout(),e.push("/authorization")}catch{}}return(i,n)=>{const u=b("el-icon"),d=b("router-link"),h=b("el-button");return _(),P("nav",ce,[S("div",le,[n[0]||(n[0]=S("div",{class:"navbar-brand"},[S("img",{src:M,alt:"FICO Learning",class:"logo"}),S("span",{class:"brand-text"},"SAP FICO English Learning")],-1)),S("div",ue,[(_(!0),P(D,null,F(o.value,f=>(_(),U(d,{key:f.name,to:f.path,class:K(["nav-item",{active:c(f.path)}])},{default:C(()=>[f.icon?(_(),U(u,{key:0},{default:C(()=>[(_(),U(j(f.icon)))]),_:2},1024)):q("",!0),S("span",null,E(f.label),1)]),_:2},1032,["to","class"]))),128))]),S("div",de,[J(h,{type:"danger",icon:N(H),size:"small",onClick:l},{default:C(()=>[$(E(N(s)("common.logout")),1)]),_:1},8,["icon"])])])])}}}),we=ie(ge,[["__scopeId","data-v-8c896331"]]);class he{constructor(){v(this,"synth");v(this,"state",{speaking:!1,paused:!1,currentUtterance:null});v(this,"accentSettings",{indian:{rate:1.1,lang:"en-IN"},singapore:{rate:.95,lang:"en-SG"},western:{rate:1,lang:"en-US"}});v(this,"genderSettings",{male:{pitch:.55,rateMultiplier:.9},female:{pitch:1.3,rateMultiplier:1}});this.synth=window.speechSynthesis,typeof window<"u"&&window.addEventListener("beforeunload",()=>{this.stop()})}getVoices(){return this.synth.getVoices()}selectVoice(t,e){const r=this.getVoices();if(r.length===0)return null;const s=this.accentSettings[t].lang||"en-US";let o=r.filter(l=>l.lang.startsWith(s));if(o.length===0&&(o=r.filter(l=>l.lang.startsWith("en"))),console.log("Available voices for",t,":",o.map(l=>l.name)),e==="male"){const l=["male","david","daniel","james","robert","mark","microsoft david","google us english","english us","alex","fred","junior","ralph","bruce","google usa","microsoft desktop"];for(const u of l){const d=o.find(h=>h.name.toLowerCase().includes(u));if(d)return console.log("Selected male voice:",d.name),d}const i=["female","zira","samantha","karen","susan","fiona","victoria","microsoft zira","microsoft samantha","google uk english female","siri"],n=o.find(u=>!i.some(d=>u.name.toLowerCase().includes(d)));if(n)return console.log("Selected non-female voice:",n.name),n}else{const l=["female","zira","samantha","karen","susan","fiona","victoria","microsoft zira","microsoft samantha","google uk english female","siri","siri female"];for(const i of l){const n=o.find(u=>u.name.toLowerCase().includes(i));if(n)return console.log("Selected female voice:",n.name),n}}const c=o[0]||r[0];return console.log("Using fallback voice:",c==null?void 0:c.name),c}speak(t,e){return new Promise((r,s)=>{this.stop();const o=new SpeechSynthesisUtterance(t),c=this.accentSettings[e.accent],l=this.genderSettings[e.gender];o.rate=c.rate*e.rate*(l.rateMultiplier||1),o.pitch=l.pitch,o.lang=c.lang||"en-US",console.log("TTS Settings - Rate:",o.rate,"Pitch:",o.pitch,"Gender:",e.gender);const i=this.selectVoice(e.accent,e.gender);i&&(o.voice=i),o.onstart=()=>{this.state.speaking=!0,this.state.currentUtterance=o},o.onend=()=>{this.state.speaking=!1,this.state.currentUtterance=null,r()},o.onerror=n=>{this.state.speaking=!1,this.state.currentUtterance=null,s(new Error(`TTS error: ${n.error}`))},this.synth.speak(o)})}pause(){this.state.speaking&&!this.state.paused&&(this.synth.pause(),this.state.paused=!0)}resume(){this.state.paused&&(this.synth.resume(),this.state.paused=!1)}stop(){this.state.speaking&&(this.synth.cancel(),this.state.speaking=!1,this.state.paused=!1,this.state.currentUtterance=null)}isSpeaking(){return this.state.speaking&&!this.state.paused}isPaused(){return this.state.paused}getState(){return{...this.state}}}const y=new he;class fe{constructor(t){v(this,"apiKey");v(this,"state",{playing:!1,paused:!1,currentAudio:null});v(this,"voiceMap",{indian:{male:["en-IN-Wavenet-B","en-IN-Standard-B"],female:["en-IN-Wavenet-D","en-IN-Wavenet-A","en-IN-Standard-D"]},singapore:{male:["en-AU-Wavenet-B","en-AU-Standard-B"],female:["en-AU-Wavenet-A","en-AU-Standard-A"]},western:{male:["en-US-Wavenet-B","en-US-Wavenet-D","en-US-Standard-B","en-US-Standard-D"],female:["en-US-Wavenet-A","en-US-Wavenet-C","en-US-Standard-A","en-US-Standard-C"]}});this.apiKey=t}getVoiceName(t,e){return this.voiceMap[t][e][0]}convertPitch(t){return(t-1)*40}convertRate(t){return Math.max(.25,Math.min(4,t))}convertGender(t){return t==="male"?"MALE":"FEMALE"}getLanguageCode(t){return{indian:"en-IN",singapore:"en-AU",western:"en-US"}[t]}async speak(t,e){return new Promise((r,s)=>{this.stop();const o=this.getVoiceName(e.accent,e.gender),c=this.getLanguageCode(e.accent),l={input:{text:t},voice:{languageCode:c,name:o,ssmlGender:this.convertGender(e.gender)},audioConfig:{audioEncoding:"MP3",speakingRate:this.convertRate(e.rate),pitch:this.convertPitch(e.gender==="male"?.9:e.accent==="indian"?1:1.15)}};console.log("Google TTS Request:",{voice:o,lang:c,gender:e.gender,rate:e.rate}),fetch(`https://texttospeech.googleapis.com/v1/text:synthesize?key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}).then(i=>i.ok?i.json():i.json().then(n=>{throw new Error(`Google TTS API error: ${JSON.stringify(n)}`)})).then(i=>{if(!i.audioContent)throw new Error("No audio content in response");const n=this.base64ToUint8Array(i.audioContent),u=new Blob([n],{type:"audio/mp3"}),d=URL.createObjectURL(u),h=new Audio(d);h.onplay=()=>{this.state.playing=!0,this.state.currentAudio=h},h.onended=()=>{this.state.playing=!1,this.state.currentAudio=null,URL.revokeObjectURL(d),r()},h.onerror=f=>{this.state.playing=!1,this.state.currentAudio=null,URL.revokeObjectURL(d),s(new Error("Audio playback error"))},h.play().catch(f=>{this.state.playing=!1,this.state.currentAudio=null,URL.revokeObjectURL(d),s(f)})}).catch(i=>{this.state.playing=!1,this.state.currentAudio=null,s(i)})})}pause(){this.state.currentAudio&&this.state.playing&&(this.state.currentAudio.pause(),this.state.paused=!0)}resume(){this.state.currentAudio&&this.state.paused&&(this.state.currentAudio.play(),this.state.paused=!1)}stop(){this.state.currentAudio&&(this.state.currentAudio.pause(),this.state.currentAudio.currentTime=0,this.state.currentAudio=null),this.state.playing=!1,this.state.paused=!1}isPlaying(){return this.state.playing&&!this.state.paused}isPaused(){return this.state.paused}getState(){return{...this.state}}base64ToUint8Array(t){const e=atob(t),r=new Uint8Array(e.length);for(let s=0;s<e.length;s++)r[s]=e.charCodeAt(s);return r}}const w=new fe("AIzaSyDQdlh_W85LbCKgtPHMQvq8t3dOx1h7mds");class me{constructor(){v(this,"engine","google")}setEngine(t){this.engine=t,console.log("TTS Engine switched to:",t)}getEngine(){return this.engine}async speak(t,e){if(this.engine==="google")return w.speak(t,e);{const r={...e,rate:e.rate*(e.gender==="male"?.9:1)};return y.speak(t,r)}}pause(){this.engine==="google"?w.pause():y.pause()}resume(){this.engine==="google"?w.resume():y.resume()}stop(){this.engine==="google"?w.stop():y.stop()}isPlaying(){return this.engine==="google"?w.isPlaying():y.isSpeaking()}isPaused(){return this.engine==="google"?w.isPaused():y.isPaused()}getVoices(){return this.engine==="web"?y.getVoices():[]}getEngineInfo(){return this.engine==="google"?{name:"Google Cloud TTS",description:"高质量云端语音合成，真实口音效果"}:{name:"浏览器内置 TTS",description:"使用系统语音包，可能需要安装额外语音"}}}const T=new me,I="fico_settings",R={ttsAccent:"western",ttsGender:"female",ttsRate:1,autoPlay:!1,showChinese:!0},pe=ae("settings",()=>{const a=A({...R});function t(){try{const n=localStorage.getItem(I);if(n){const u=JSON.parse(n);u.ttsRate===.8||u.ttsRate===.75?u.ttsRate=.6:(u.ttsRate===1.2||u.ttsRate===1.4)&&(u.ttsRate=1.6),a.value={...R,...u}}}catch(n){console.error("Failed to load settings:",n)}}function e(){try{localStorage.setItem(I,JSON.stringify(a.value))}catch(n){console.error("Failed to save settings:",n)}}function r(n){a.value.ttsAccent=n,e()}function s(n){a.value.ttsGender=n,e()}function o(n){a.value.ttsRate=n,e()}function c(n){a.value.autoPlay=n,e()}function l(n){a.value.showChinese=n,e()}function i(){a.value={...R},e()}return t(),{settings:a,ttsAccent:m(()=>a.value.ttsAccent),ttsGender:m(()=>a.value.ttsGender),ttsRate:m(()=>a.value.ttsRate),autoPlay:m(()=>a.value.autoPlay),showChinese:m(()=>a.value.showChinese),setTTSAccent:r,setTTSGender:s,setTTSRate:o,setAutoPlay:c,setShowChinese:l,resetSettings:i,saveSettings:e}});function Ae(){const a=pe(),t=A(!1),e=A(!1),r=A(1),s=A(0),o=A("google");r.value=a.ttsRate,se(()=>a.ttsRate,g=>{r.value=g});const c=m(()=>({accent:a.ttsAccent,gender:a.ttsGender,rate:r.value})),l=m(()=>T.getEngineInfo());async function i(g,p){try{t.value=!0,e.value=!1,s.value=0;const k={accent:(p==null?void 0:p.accent)||c.value.accent,gender:(p==null?void 0:p.gender)||c.value.gender,rate:(p==null?void 0:p.rate)||c.value.rate};T.setEngine(o.value),await T.speak(g,k),s.value=100}catch(k){throw console.error("TTS error:",k),k}finally{t.value=!1,e.value=!1}}function n(){T.pause(),e.value=!0}function u(){T.resume(),e.value=!1}function d(){T.stop(),t.value=!1,e.value=!1,s.value=0}function h(g){r.value=g}function f(g){a.setTTSAccent(g)}function L(g){a.setTTSGender(g)}function G(g){o.value=g,T.setEngine(g)}return oe(()=>{d()}),{isPlaying:t,isPaused:e,currentSpeed:r,progress:s,currentAccent:m(()=>c.value.accent),currentGender:m(()=>c.value.gender),currentEngine:o,engineInfo:l,speak:i,pause:n,resume:u,stop:d,setSpeed:h,setAccent:f,setGender:L,setEngine:G}}export{we as T,pe as a,Ae as u};
